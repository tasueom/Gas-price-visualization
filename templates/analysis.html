{% extends "layout.html" %}

{% block content %}
<h2>분석 결과</h2>

<div class="btn-container">
    <button id="bar-btn" onclick="showBarChart()">유가 평균 분석</button>
    <button id="pie-btn" onclick="showPieChart()">지점 분석</button>
    <button id="distribution-btn" onclick="showDistributionChart()">유가 분포 분석</button>
</div>

<form method="GET" id="search-form">
    <input type="text" name="keyword" placeholder="검색어를 입력하세요" value="{{ keyword }}">
    <select name="column">
        <option value="gas_id" {% if column == 'gas_id' %}selected{% endif %}>고유번호</option>
        <option value="name" {% if column == 'name' %}selected{% endif %}>상호</option>
        <option value="address" {% if column == 'address' %}selected{% endif %}>주소</option>
        <option value="brand" {% if column == 'brand' %}selected{% endif %}>상표</option>
    </select>
    <input type="hidden" name="chart_type" id="chart-type-input" value="{{ chart_type }}">
    <button type="submit">검색</button>
    {% if keyword %}
        <a href="{{ url_for('analysis') }}?chart_type={{ chart_type }}">전체보기</a>
    {% endif %}
</form>

<div id = "pie-chart-container" style="display: flex; justify-content: center; gap: 100px; margin: 20px auto;">
    <div style="width: 500px; height: 500px;">
        <h3>브랜드 지점 수</h3>
        <canvas id="brand-chart"></canvas>
    </div>
    
    <div style="width: 500px; height: 500px;">
        <h3>셀프여부</h3>
        <canvas id="self-type-chart"></canvas>
    </div>
</div>

<div id = "bar-chart-container" style="display: none; justify-content: center; gap: 100px; margin: 20px auto;">
    <div style="width: 1000px; height: 1000px;">
        <h3>유가 평균</h3>
        <canvas id="price-chart"></canvas>
    </div>
</div>

<div id="distribution-chart-container" style="display: none; justify-content: center; margin: 20px auto;">
    <div style="max-width: 1400px;">
        <h3>전국 유가 분포 분석 (히스토그램 + KDE)</h3>
        <img src="{{ url_for('static', filename='img/fuel_distribution.png') }}" 
             alt="유가 분포 히스토그램" 
             style="width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px;">
    </div>
</div>

<!-- 차트 데이터 전역 변수로 선언 -->
<script>
    const brandData = {{ brand_data|tojson }};
    const selfTypeData = {{ self_type_data|tojson }};
    const priceData = {{ price_data|tojson }};
    const currentChartType = "{{ chart_type }}";
</script>

<!-- 차트 함수 및 로직 -->
<script src="{{ url_for('static', filename='js/chart.js') }}"></script>
{% endblock %}